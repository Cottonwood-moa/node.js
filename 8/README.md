# 몽고디비
몽고디비의 특징 중 하나는 자바스크립트 문법은 사용한다는 것이다.
노드도 자바스크립트를 사용하므로 데이터베이스마저 몽고디비를 사용한다면 자바스크립트만 사용하여 웹 애플리케이션을 만들 수 있는 것이다.
하나의 언어만 사용하면 되므로 생산성도 매우 높다.
하지만 몽고디비는 흔히 사용하는 RDBMS 가 아니라 특색이 뚜렷한 NoSQL 이므로 특징을 잘 알고 사용해야 한다.

## NoSQL vs SQL
MySQL은 SQL을 사용하는 대표적인 데이터베이스이다.
반면에 SQL을 사용하지 않는, NoSQL이라고 부르는 데이터베이스도 있다.
몽고디비는 NoSQL의 대표 주자이다.

SQL과 NoSQL은 여러 측면에서 다른데, 그중에서 대표적인 몇 가지 차이점만 알아보자.

    SQL(MySQL)               NoSQL(몽고디비)
규칙에 맞는 데이터 입력     자유로운 데이터 입력
테이블간 JOIN 지원          컬렉션 간 JOIN 미지원
안정성, 일관성              확장성, 가용성
용어(테이블,로우,컬럼)      용어(컬렉션,다큐먼트,필드)

먼저 NoSQL에는 고정된 테이블이 없다.
테이블에 상응하는 컬렉션이라는 개념이 있긴 하지만, 컬럼을 따로 정의하지는 않는다.
예를 들어 MySQL은 users 테이블을 만들 때 name,age,married 등의 컬럼과 자료형 옵션 등을 정의하지만, 몽고디비는 그냥 users 컬렉션을 만들고 끝이다.
users 컬렉션에는 어떠한 데이터든 들어갈 수 있다. 
어떤 다큐먼트(MySQL의 로우에 해당하는 개념)에는 name,age,married 데이터가, 다른 다큐먼트에는 name,comment,createdAt, updateAt 등의 데이터가 들어갈 수 있다.

몽고디비에는 MySQL 과 달리  JOIN 기능이 없다.
JOIN을 흉내낼 수는 있지만, 하나의 쿼리가 섞여 예상치 못한 결과를 낼 가능성이 있다는 것도 단점이다.
이렇나 단점에도 몽고디비를 사용하는 이유는 확장성과 가용성 때문이다.
데이터의 일관성을 보장해주는 기능이 약한 대신, 데이터를 빠르게 넣을 수 있고 쉽게 여러 서버에 데이터를 분산할 수 있다.
용어도 조금 다르다.
MySQL의 테이블, 로우, 컬럼을 몽고디비에서는 각각 컬렉션, 다큐먼트, 필드 라고 부른다.

애플리케이션을 만들 때 꼭 한 가지 데이터베이스만 사용해야 하는 것은 아니다.
많은 기업이 SQL과 NoSQL을 동시에 사용하고 있다.
SQL 과 NoSQL은 서로 다릉 특징을 가지므로 알맞은 곳에 사용하면 된다.
예를 들어 항공사 예약 시스템의 경우, 비행이 표에 관한 정보가 모든 항공사에 일관성 있게 전달되어야 하므로 예약 처리 부분의 데이터베이스는 MySQL을 사용한다.
하지만 핵심 기능외의 빅데이터, 메시징, 세션 관리 등에는 확장성과 가용성을 위해 몽고 디비를 사용할 수도 있다.

## 몽고디비 설치하기
몽고디비는 공식사이트에서 내려받을 수 있다.

설치를 완료한 후에는 해야 할 작업이 있다.
서버를 실행하기 전에 데이터가 저장될 폴더를 먼저 만든다.
윈도의 경우 C:/에 data 폴더를 만들고, 다시 그 안에 db 폴더를 만들면 된다.

몽고디비가 설치된 경로(기본적으로 C:\Program Files\MongoDB\Server\4.4\bin)로 이동해서 몽고디비를 실행한다.
C:/data/db 폴더가 없으면 실행되지 않으므로 반스디 폴더를 먼저 만들어야 한다.
콘솔에서 mongod 명령어를 입력하여 몽고디비를 실행한다.
방화벽 관련 팝업이 뜨면 허용 버튼을 눌러 접속을 허가한다.

    $ cd "C:\Program Files\MongoDB\Server\4.2\bin"
    $ mongod
    //생략
    waiting for connections on port 27017

에러 메시지 없이 계속 실행 중이라면 실행에 설공한 것이다.
기본적으로 27017번 포트에서 실행된다.
몽고디비를 사용할 일이 있을때마다 mongod 명령어로 먼저 서버를 실행해야 한다.

    매번 실행하기 귀찮다면
    p.353 참조

몽고디비 프롬프트에 접속하려면 같은 폴더에서 콘솔을 하나 더 열어 mongo 명령어를 입력한다.

프롬프트가 >로 바뀌었다면 성공이다.
현재 누구나 몽고디비에 접속할 수 있으므로 관리자 계정을 추가한다.

    >use admin
    switched to db admin
    >db.createUser({user:'이름',pwd:'비밀번호',roles:['root']})
    Successfully added user:{"user":"root","roles":["root]}

db.createUser 메서드로 계정을 생성할 수 있다.
user에 사용자 이름을 넣고, pwd 자리에 사용할 비밀번호를 입력한다.
이 비밀번호는 기억하고 있어야 한다.
roles로는 현재 모든 권한이 있는 root를 부여했다.
나중에 실무에서는 상황에 맞는 역할을 부여하면 된다.

아까 mongod 를 입력했던 콘솔을 종료한 뒤, 이번에는 mongod --auth 명령어로 접속한다.
--auth는 로그인이 필요하다는 뜻이다.

이제 mongo를 입력했던 콘솔도 종료한 후 다시 mongo admin -u 이름 -p 비밀번호 명령어로 접속한다.

## 데이터베이스 및 컬렉션 생성하기
이제 nodejs 라는 이름의 데이터베이스와 7장의 MySQL 테이블에 상응하는 컬렉션을 만들어보자.
몽고디비 프롬프트에 접속한 후 진행하면 된다.

데이터베이스를 만드는 명령어는 use [데이터베이스명]이다.

    > use nodejs
    switched to db nodejs

데이터베이스 목록을 확인하는 명령어는 show dbs 이다.

    > show dbs     
    admin   0.000GB
    config  0.000GB
    local   0.000GB
    >

방금 생성한 nodejs가 없다.
하지만 당황할 필요는 없다.
데이터를 최소 한 개 이상 넣어야  목록에 표시된다.
현재 사용 중인 데이터베이스를 확인하는 명령어는 db 이다.
    > db  
    nodejs

비록 데이터베이스 목록에는 없지만 현재 nodejs 데이터베이스를 사용하고 있음을 확인할 수 있다.
컬렉션은 따로 생성하지 않아도 된다.
다큐먼트를 넣는 순간 컬렉션도 자동으로 생성된다.
하지만 다음과 같이 직접 컬렉션을 생성하는 명령어가 있긴 하다.

    > db.createCollection('users')
    { "ok" : 1 }
    > db.createCollection('comments')
    { "ok" : 1 }

생성한 컬렉션 목록을 확인해보자.

    > show collections
    comments
    users

컴퍼스 사용시 p.364 참조
